<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CliniCon – Tool</title>

  <style>
    :root{
      --bg:#f5f7fb; --panel:#ffffff; --muted:#94a3b8; --text:#0f172a; --line:#e2e8f0;
      --accent:#2563eb; --accent-weak:#dbeafe; --accent-strong:#1d4ed8;
      --success:#16a34a; --shadow:0 18px 36px rgba(15,23,42,.08);
      --gold:#facc15; --gold-strong:#eab308; --gold-bg:#fff8db;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      color:var(--text); background:var(--bg);
    }

    .shell{display:grid; grid-template-columns:240px 1fr; min-height:100dvh}

    /* ==== Sidebar ==== */
    .side{
      position:sticky; top:0; height:100dvh; background:#ffffffcc; backdrop-filter:saturate(180%) blur(10px);
      border-right:1px solid var(--line); display:flex; flex-direction:column; align-items:stretch; gap:12px; padding:16px 12px;
      width:240px; overflow:auto
    }
    .brand{
      display:flex; align-items:center; justify-content:center; padding:8px 10px; width:100%; text-decoration:none
    }
    .brand img{width:180px; height:auto; object-fit:contain}

    .nav{display:flex; flex-direction:column; gap:8px; width:100%; margin-top:8px}

    /* Einheitliches Button-Design */
    .nav a{
      --bg1:#fff; --bg2:#f9fbff;
      display:flex; align-items:center; gap:12px;
      text-decoration:none; color:var(--text);
      padding:12px 14px; border-radius:14px; border:1px solid var(--line);
      background:linear-gradient(180deg,var(--bg1),var(--bg2));
      box-shadow:0 1px 0 rgba(15,23,42,.03);
      transition:.18s ease transform, .18s ease box-shadow, .18s ease border-color, .18s ease background;
    }
    .nav a:hover{
      transform:translateY(-1px);
      border-color:#bfd7ff;
      background:linear-gradient(180deg,#ffffff,#eef5ff);
      box-shadow:0 6px 14px rgba(37,99,235,.12);
    }
    .nav a.active{
      background:linear-gradient(180deg,#2563eb,#1d4ed8);
      color:#fff; border-color:transparent;
      box-shadow:0 10px 20px rgba(37,99,235,.25);
    }
    .nav a svg{
      width:22px; height:22px; flex:0 0 22px;
      opacity:.9
    }
    .nav a.active svg{ opacity:1; filter:brightness(10) }

    /* ==== Geschützter Bereich (Gold-Styling) ==== */
    .nav a.secure{
      background:linear-gradient(180deg,var(--gold-bg),#fffef4);
      border-color:#fde68a;
      color:#854d0e;
      font-weight:600;
    }
    .nav a.secure:hover{
      background:linear-gradient(180deg,#fff5b1,#fffef4);
      box-shadow:0 6px 14px rgba(250,204,21,.25);
      border-color:var(--gold);
      transform:translateY(-1px);
    }
    .nav a.secure.active{
      background:linear-gradient(180deg,var(--gold),var(--gold-strong));
      color:#fff;
      border:none;
      box-shadow:0 10px 22px rgba(250,204,21,.35);
    }

    header{
      display:flex; align-items:flex-start; justify-content:space-between;
      gap:16px; padding:20px 24px; border-bottom:1px solid var(--line); background:#fff; position:sticky; top:0; z-index:2
    }
    .topbar-left h1{ margin:0; font-size:1.6rem; letter-spacing:.02em }
    .topbar-left p{ margin:6px 0 0; color:var(--muted); font-size:.98rem }
    .product-logo{ height:56px; width:auto; object-fit:contain }

    main{ padding:24px; display:grid; gap:20px; grid-template-columns:repeat(12,1fr) }
    .card{ background:var(--panel); border:1px solid var(--line); border-radius:16px; padding:24px; box-shadow:var(--shadow) }

    footer{ padding:18px 24px; color:var(--muted); text-align:right }

    #ppug-tool{grid-column:1/-1}
    #ppug-tool .ppug-grid{display:grid;gap:16px;grid-template-columns:repeat(12,1fr)}
    #ppug-tool .ppug-card{grid-column:1/-1;background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:18px}
    #ppug-tool h2{margin:0 0 6px;font-size:1.35rem;color:#0f172a}
    #ppug-tool p.muted{margin:4px 0 0;color:var(--muted);font-size:.95rem}
    #ppug-tool .row{display:grid;gap:12px;grid-template-columns:repeat(12,1fr);align-items:end}
    #ppug-tool label{display:flex;flex-direction:column;gap:6px;font-size:.9rem;color:#475569}
    #ppug-tool input,#ppug-tool select{padding:10px 12px;border-radius:10px;border:1px solid var(--line);background:#fff;font:inherit}
    #ppug-tool input:focus,#ppug-tool select:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px rgba(37,99,235,.18)}
    #ppug-tool .btn{appearance:none;border:1px solid var(--line);border-radius:12px;padding:10px 14px;font-weight:600;cursor:pointer;background:#fff;color:#0f172a;transition:.18s ease all}
    #ppug-tool .btn.preset.active{background:rgba(37,99,235,.12);border-color:var(--accent);color:var(--accent)}
    #ppug-tool .preset-wrap{display:flex;flex-wrap:wrap;gap:8px}
    #ppug-tool .result{display:grid;gap:12px;grid-template-columns:repeat(12,1fr)}
    #ppug-tool .col{display:grid;gap:12px}
    #ppug-tool .kpi{display:grid;gap:6px;padding:14px;border:1px solid var(--line);border-radius:12px;background:#fff;text-align:center}
    #ppug-tool .kpi.large{min-height:110px}
    #ppug-tool .kpi.large small{color:var(--muted);font-size:.95rem}
    #ppug-tool .kpi.large strong{font-size:2.1rem;line-height:1.1}
    #ppug-tool .kpi.small{grid-column:span 6}
    #ppug-tool .kpi.small strong{font-size:1.2rem}
    #ppug-tool .day{background:#f0f9ff}
    #ppug-tool .night{background:#fff7ed}
    #ppug-tool .table-wrap{overflow:auto;border:1px solid var(--line);border-radius:12px}
    #ppug-tool table{width:100%;border-collapse:collapse;min-width:820px;background:#fff}
    #ppug-tool th,#ppug-tool td{padding:10px 12px;border-bottom:1px solid var(--line);text-align:left}
    #ppug-tool thead th{background:#f8fafc}

    @media (max-width: 960px){
      .shell{ grid-template-columns:1fr }
      .side{ position:relative; height:auto; width:100%; flex-direction:row; align-items:center; justify-content:space-between; padding:12px 16px }
      .nav{ flex-direction:row; overflow-x:auto; padding-bottom:4px }
      .nav a{ white-space:nowrap }
      header{ position:relative }
      main{ grid-template-columns:1fr; padding:20px }
    }
    @media (max-width: 880px){
      #ppug-tool .left,#ppug-tool .right{grid-column:span 12}
      #ppug-tool .kpi.small{grid-column:span 12}
    }
  </style>
</head>
<body>
  <div class="shell">
    <aside class="side" aria-label="Hauptnavigation">
      <a class="brand" href="index.html" aria-label="Startseite">
        <img src="Bilder/CliniConLogo.png" alt="CliniCon Logo" />
      </a>

      <nav class="nav" id="mainNav">
        <a href="index.html" data-key="index">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9.5L12 3l9 6.5V21a1 1 0 0 1-1 1h-5v-6H9v6H4a1 1 0 0 1-1-1V9.5z"/></svg>
          <span>Start</span>
        </a>
        <a href="0_PpUG-Rechner.html" data-key="ppug">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
          <span>PPUG-Rechner</span>
        </a>
        <a href="0_PPBV-Berechnung.html" data-key="ppbv">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="4" y1="21" x2="4" y2="14"/><line x1="4" y1="10" x2="4" y2="3"/><line x1="12" y1="21" x2="12" y2="12"/><line x1="12" y1="8" x2="12" y2="3"/><line x1="20" y1="21" x2="20" y2="16"/><line x1="20" y1="12" x2="20" y2="3"/><line x1="1" y1="14" x2="7" y1="14"/><line x1="9" y1="8" x2="15" y2="8"/><line x1="17" y1="16" x2="23" y2="16"/></svg>
          <span>PPBV-Berechnung</span>
        </a>
        <a href="0_Schichtbesetzung.html" data-key="schichten">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y1="10"/></svg>
          <span>Schichtbesetzung</span>
        </a>
        <a href="0_Besetzungsbedarf.html" data-key="bedarf">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H7a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
          <span>Besetzungsbedarf</span>
        </a>
        <a href="0_Perzentilen-Berechnung.html" data-key="perzentilen">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="3" x2="3" y2="21"/><line x1="21" y1="21" x2="3" y2="21"/><rect x="7" y="10" width="3" height="7"/><rect x="12" y="6" width="3" height="11"/><rect x="17" y="13" width="3" height="4"/></svg>
          <span>Perzentilen</span>
        </a>

        <!-- Geschützter Bereich -->
        <a href="0_Login.html" class="secure" data-key="secure" aria-label="Geschützter Bereich">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="10" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
          <span>Geschützter Bereich</span>
        </a>
      </nav>
    </aside>

    <div>
      <header>
        <div class="topbar-left">
          <h1 id="pageHeading">CliniCon – Das Krankenhaus-Management-Tool</h1>
          <p id="pageSubheading">Smarte Werkzeuge für Planung, Qualität und Navigation im Klinikalltag.</p>
        </div>
        <img class="product-logo" src="Bilder/CliniConLogo.png" alt="CliniCon Logo" />
      </header>

      <main id="main" role="main">
        <section class="card" id="ppug-tool">
          <div class="ppug-grid">
            <div class="ppug-card">
              <h2>PPUG-Rechner</h2>
              <p class="muted">Berechnet die <strong>Mindestbesetzung</strong> und den <strong>Hilfskraftanteil</strong> nach PpUG.</p>

              <div class="row" style="margin-top:12px">
                <label style="grid-column:span 4">
                  Bereich
                  <select id="ppug-area-a"></select>
                </label>
                <label style="grid-column:span 4">
                  Belegte Betten (Tag)
                  <input id="ppug-pat-day" type="number" min="0" step="1" value="24" />
                </label>
                <label style="grid-column:span 4">
                  Belegte Betten (Nacht)
                  <input id="ppug-pat-night" type="number" min="0" step="1" value="24" />
                </label>
              </div>

              <div class="row" style="margin-top:8px">
                <label style="grid-column:span 3">
                  Rundung
                  <select id="ppug-round">
                    <option value="ceil">Immer aufrunden (empfohlen)</option>
                    <option value="std">Standard (≥0,5 auf, sonst ab)</option>
                  </select>
                </label>
                <div style="grid-column:span 9">
                  <div class="preset-wrap">
                    <button type="button" class="btn preset" id="p-16">16 Betten</button>
                    <button type="button" class="btn preset" id="p-18">18 Betten</button>
                    <button type="button" class="btn preset" id="p-24">24 Betten</button>
                    <button type="button" class="btn preset" id="p-32">32 Betten</button>
                    <button type="button" class="btn preset" id="p-36">36 Betten</button>
                    <button type="button" class="btn preset" id="p-40">40 Betten</button>
                  </div>
                </div>
              </div>

              <div class="result" style="margin-top:16px" id="ppug-out">
                <div class="col left" style="grid-column:span 6">
                  <div class="kpi large day">
                    <small>Mindestbesetzung Tag (gesamt)</small>
                    <strong id="kpi-day">&ndash;</strong>
                    <small id="kpi-day-split">Fachpersonen / Hilfskräfte: &ndash; / &ndash;</small>
                  </div>
                  <div class="row" style="gap:12px">
                    <div class="kpi small day">
                      <small>Verhältnis (Tag)</small>
                      <strong id="kpi-ratio-day">&ndash;</strong>
                      <small>Pat. : Pflegekraft</small>
                    </div>
                    <div class="kpi small day">
                      <small>Max. Hilfskräfte (Tag)</small>
                      <strong id="kpi-cap-day">&ndash; %</strong>
                      <small>Zulässiger Anteil</small>
                    </div>
                  </div>
                </div>

                <div class="col right" style="grid-column:span 6">
                  <div class="kpi large night">
                    <small>Mindestbesetzung Nacht (gesamt)</small>
                    <strong id="kpi-night">&ndash;</strong>
                    <small id="kpi-night-split">Fachpersonen / Hilfskräfte: &ndash; / &ndash;</small>
                  </div>
                  <div class="row" style="gap:12px">
                    <div class="kpi small night">
                      <small>Verhältnis (Nacht)</small>
                      <strong id="kpi-ratio-night">&ndash;</strong>
                      <small>Pat. : Pflegekraft</small>
                    </div>
                    <div class="kpi small night">
                      <small>Max. Hilfskräfte (Nacht)</small>
                      <strong id="kpi-cap-night">&ndash; %</strong>
                      <small>Zulässiger Anteil</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="ppug-card">
              <h3 style="margin:0 0 10px">Hinterlegte PpUG &amp; Hilfskraft-Grenzen (Stand: 15.10.2025)</h3>
              <div class="table-wrap">
                <table id="ppug-table">
                  <thead>
                    <tr>
                      <th>Bereich</th>
                      <th>Tag (Pat.:1)</th>
                      <th>Nacht (Pat.:1)</th>
                      <th>Max. Hilfskräfte Tag</th>
                      <th>Max. Hilfskräfte Nacht</th>
                    </tr>
                  </thead>
                  <tbody id="ppug-tbody"></tbody>
                </table>
              </div>
              <p class="muted" style="margin-top:8px">
                Gemischte Stationen werden nicht abgebildet. Hier muss der Bereich mit der <strong>strengeren Personaluntergrenze</strong> gewählt werden.
              </p>
            </div>
          </div>
        </section>
      </main>

      <footer>&copy; CliniCon</footer>
    </div>
  </div>

  <script>
    (function(){
      const path = (location.pathname.split('/').pop() || '').toLowerCase();
      const map = {
        'index.html':'index',
        '0_ppug-rechner.html':'ppug',
        '0_ppbv-berechnung.html':'ppbv',
        '0_schichtbesetzung.html':'schichten',
        '0_besetzungsbedarf.html':'bedarf',
        '0_perzentilen-berechnung.html':'perzentilen',
        '0_login.html':'secure',
        '1_unterstartseite.html':'secure',
        'clinicon layout.html':'ppug',
        'clinicon%20layout.html':'ppug'
      };
      const titles = {
        index:['Start','Übersicht & Schnellzugriff'],
        ppug:['PPUG-Rechner','Untergrenzen schnell prüfen'],
        ppbv:['PPBV-Berechnung','Parameter steuern & vergleichen'],
        schichten:['Schichtbesetzung','Planung & Visualisierung'],
        bedarf:['Besetzungsbedarf','Anforderung je Tag & Schicht'],
        perzentilen:['Perzentilen-Rechner','Wachstum verständlich darstellen'],
        secure:['Geschützter Bereich','Zugriff für autorisierte Nutzer']
      };
      const key = map[path] || null;
      if(key){
        const link = document.querySelector('.nav a[data-key="'+key+'"]');
        if(link) link.classList.add('active');
        if(titles[key]){
          document.getElementById('pageHeading').textContent = 'CliniCon – ' + titles[key][0];
          document.getElementById('pageSubheading').textContent = titles[key][1];
          document.title = 'CliniCon – ' + titles[key][0];
        }
      }
    })();

    (function(){
      const get = id => document.getElementById(id);
      const areaSelect = get('ppug-area-a');
      if(!areaSelect) return;

      const PPU_REGELN = [
        {key:'intensiv',name:'Intensivmedizin',ratioDay:2,ratioNight:3,capDay:5,capNight:5},
        {key:'geriatrie',name:'Geriatrie',ratioDay:10,ratioNight:20,capDay:15,capNight:20},
        {key:'chir_ortho',name:'Allgemeine Chirurgie / Unfallchirurgie / Orthopädie',ratioDay:10,ratioNight:20,capDay:10,capNight:10},
        {key:'innere_kardio',name:'Innere Medizin / Kardiologie',ratioDay:10,ratioNight:22,capDay:10,capNight:10},
        {key:'herzchir',name:'Herzchirurgie',ratioDay:7,ratioNight:15,capDay:5,capNight:0},
        {key:'neuro',name:'Neurologie',ratioDay:10,ratioNight:20,capDay:8,capNight:8},
        {key:'stroke',name:'Neurologische Schlaganfalleinheit',ratioDay:3,ratioNight:5,capDay:0,capNight:0},
        {key:'fruehrehab',name:'Neurologische Frührehabilitation',ratioDay:5,ratioNight:12,capDay:10,capNight:10},
        {key:'paed_allg',name:'Allgemeine Pädiatrie',ratioDay:6,ratioNight:10,capDay:5,capNight:5},
        {key:'paed_spez',name:'Spezielle Pädiatrie',ratioDay:6,ratioNight:14,capDay:5,capNight:5},
        {key:'neo',name:'Neonatologische Pädiatrie',ratioDay:3.5,ratioNight:5,capDay:5,capNight:5},
        {key:'gyn',name:'Gynäkologie & Geburtshilfe',ratioDay:7.5,ratioNight:15,capDay:5,capNight:0},
        {key:'hno_rheuma_uro',name:'HNO, Rheumatologie & Urologie',ratioDay:10,ratioNight:22,capDay:10,capNight:5},
        {key:'neurochir',name:'Neurochirurgie',ratioDay:9,ratioNight:18,capDay:10,capNight:5}
      ];

      const tbody = get('ppug-tbody');
      PPU_REGELN.forEach(rule => {
        const option = document.createElement('option');
        option.value = rule.key;
        option.textContent = rule.name;
        areaSelect.appendChild(option);

        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${rule.name}</td>
          <td>${rule.ratioDay}</td>
          <td>${rule.ratioNight}</td>
          <td>${rule.capDay}%</td>
          <td>${rule.capNight}%</td>
        `;
        tbody.appendChild(row);
      });
      areaSelect.value = 'chir_ortho';

      const inputs = {
        day: get('ppug-pat-day'),
        night: get('ppug-pat-night'),
        mode: get('ppug-round')
      };

      const outputs = {
        totalDay: get('kpi-day'),
        totalNight: get('kpi-night'),
        splitDay: get('kpi-day-split'),
        splitNight: get('kpi-night-split'),
        ratioDay: get('kpi-ratio-day'),
        ratioNight: get('kpi-ratio-night'),
        capDay: get('kpi-cap-day'),
        capNight: get('kpi-cap-night')
      };

      const presets = [
        {id:'p-16', value:16},
        {id:'p-18', value:18},
        {id:'p-24', value:24},
        {id:'p-32', value:32},
        {id:'p-36', value:36},
        {id:'p-40', value:40}
      ];

      const presetButtons = [];
      function markActive(btn){
        presetButtons.forEach(b => b.classList.remove('active'));
        if(btn) btn.classList.add('active');
      }

      presets.forEach(({id,value}) => {
        const btn = get(id);
        if(!btn) return;
        presetButtons.push(btn);
        btn.addEventListener('click', () => {
          inputs.day.value = value;
          inputs.night.value = value;
          markActive(btn);
          calc();
        });
      });

      function roundByMode(amount, mode){
        return mode === 'ceil' ? Math.ceil(amount) : Math.round(amount);
      }

      function enforceCaps(total, capPct){
        const maxHelpers = Math.floor(total * (capPct / 100));
        const fach = Math.max(0, total - maxHelpers);
        return {fach, hilf: total - fach};
      }

      function applyMinOne(split){
        if(split.fach < 1){
          const deficit = 1 - split.fach;
          if(split.hilf >= deficit){
            split.hilf -= deficit;
          }
          split.fach = 1;
        }
        split.fach = Math.ceil(split.fach);
        split.hilf = Math.max(0, Math.floor(split.hilf));
        return split;
      }

      function formatRatio(value){
        return value.toString().replace('.', ',') + ' : 1';
      }

      function calc(){
        const rule = PPU_REGELN.find(r => r.key === areaSelect.value);
        if(!rule) return;

        const patientsDay = parseInt(inputs.day.value || '0', 10) || 0;
        const patientsNight = parseInt(inputs.night.value || '0', 10) || 0;
        const mode = inputs.mode.value;

        let needDay = roundByMode(patientsDay / rule.ratioDay, mode);
        let needNight = roundByMode(patientsNight / rule.ratioNight, mode);

        let splitDay = enforceCaps(needDay, rule.capDay);
        let splitNight = enforceCaps(needNight, rule.capNight);

        splitDay = applyMinOne(splitDay);
        splitNight = applyMinOne(splitNight);

        outputs.totalDay.textContent = splitDay.fach + splitDay.hilf;
        outputs.totalNight.textContent = splitNight.fach + splitNight.hilf;
        outputs.splitDay.textContent = `Fachpersonen / Hilfskräfte: ${splitDay.fach} / ${splitDay.hilf}`;
        outputs.splitNight.textContent = `Fachpersonen / Hilfskräfte: ${splitNight.fach} / ${splitNight.hilf}`;
        outputs.ratioDay.textContent = formatRatio(rule.ratioDay);
        outputs.ratioNight.textContent = formatRatio(rule.ratioNight);
        outputs.capDay.textContent = `${rule.capDay} %`;
        outputs.capNight.textContent = `${rule.capNight} %`;
      }

      ['ppug-area-a','ppug-pat-day','ppug-pat-night','ppug-round'].forEach(id => {
        const el = get(id);
        if(el) el.addEventListener('input', calc);
      });

      calc();
    })();
  </script>
</body>
</html>

